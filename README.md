# Документация API и инструкция по запуску проекта "Реестр книг в библиотеке"

---

## Общая информация

Проект реализован на Laravel 12 с использованием REST API. В проекте три основные сущности: Автор (Author), Книга (Book)
и Жанр (Genre). Разграничены роли пользователей: Администратор и Автор с разным уровнем доступа.

---

# Инициализация приложения

## Требования

- Docker и Docker Compose установлены на вашей машине.

## Шаги запуска

1. Клонируйте репозиторий с проектом:

```shell
git clone https://github.com/aleX13999/Simple-Library.git
cd <папка_проекта>
```

2. Создайте файл окружения `.env` командой:
```shell
cp .env.example .env
```
3. Отредактируйте `.env`, укажите необходимые настройки (под Docker):
```dotenv
NGINX_HOST=127.0.0.1
NGINX_HTTP_PORT=

DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=
DB_USERNAME=root
DB_PASSWORD=

MYSQL_HOST=127.0.0.1
MYSQL_PORT=
MYSQL_ROOT_PASSWORD=
MYSQL_DATABASE=
MYSQL_USER=root
MYSQL_PASSWORD=
MYSQL_SERVER_VERSION=8.0
```

4. Запустите контейнеры Docker:

```shell
docker-compose up -d
```

5. Выполните миграции:

```shell
docker exec -it php-fpm php artisan migrate
```

6. Выполните сиды:

Доступны 2 сида:
- [RolesAndPermissionsSeeder.php](database%2Fseeders%2FRolesAndPermissionsSeeder.php) - **Создает роли права в БД**
- [AdminUserSeeder.php](database%2Fseeders%2FAdminUserSeeder.php) - **Создает первого администратора, в дальнейшем новых администраторов может создавать только другие администраторы**

Можно выполнить одну команду, которая выполнит оба сида:
```shell
docker exec -it php-fpm php artisan db:seed
```

Или выполнить по отдельности:
```shell
docker exec -it php-fpm php artisan db:seed --class=RolesAndPermissionsSeeder
```
```shell
docker exec -it php-fpm php artisan db:seed --class=AdminUserSeeder
```

7. Сгенерируйте ключ приложения:

```shell
docker exec -it php-fpm php artisan key:generate
```

---

# Логирование

**После любых действий над данными о книге записываются короткое уведомление в логи приложения в файл `storage/logs/books.log`.**

---

# API Эндпоинты

## Авторизация и аутентификация

| Метод | URL                   | Описание                                      | Параметры             | Ответ                         |
|-------|-----------------------|-----------------------------------------------|-----------------------|-------------------------------|
| POST  | `/api/register`       | Регистрация пользователя                      | name, email, password | Токен авторизации             |
| POST  | `/api/register/admin` | Регистрация Администратора                    | name, email, password | Токен авторизации             |
| POST  | `/api/login`          | Аутентификация пользователя (админа и автора) | email, password       | Токен авторизации             |
| POST  | `/api/logout`         | Выход из системы (требует аутентификацию)     | —                     | Сообщение о выходе из системы |

## Публичная часть (доступна без аутентификации)

| Метод | URL                    | Описание                                      | Параметры      | Ответ                                            |
|-------|------------------------|-----------------------------------------------|----------------|--------------------------------------------------|
| GET   | `/api/v1/books`        | Список книг с именами авторов (пагинация)     | ?skip=, ?take= | Пагинированный список книг с авторами и жанрами  |
| GET   | `/api/v1/books/{id}`   | Детали книги по ID                            | —              | Данные конкретной книги                          |
| GET   | `/api/v1/authors`      | Список авторов с количеством книг (пагинация) | ?skip=, ?take= | Пагинированный список авторов с количеством книг |
| GET   | `/api/v1/authors/{id}` | Детали автора с его книгами                   | —              | Данные автора с массивом книг                    |
| GET   | `/api/v1/genres`       | Список жанров с количеством книг (пагинация)  | ?skip=, ?take= | Пагинированный список жанров с количеством книг  |

---

## Авторская часть (требует аутентификацию автора)

| Метод  | URL                           | Описание                                | Параметры/Тело запроса                                 | Ответ                 |
|--------|-------------------------------|-----------------------------------------|--------------------------------------------------------|-----------------------|
| PATCH  | `/api/v1/author/profile`      | Обновление данных пользователя и автора | name, email, password, firstName, lastName, patronymic | Обновленные данные    |
| PATCH  | `/api/v1/author/books/{book}` | Обновление своей книги                  | Любые изменяемые поля книги                            | Обновленная книга     |
| DELETE | `/api/v1/author/books/{book}` | Удаление своей книги                    | —                                                      | Сообщение об удалении |

---

## Административная часть (требует аутентификацию администратора)

| Метод | URL                     | Описание                                                                                                | Параметры/Тело запроса                                                  | Ответ                                                   |
|-------|-------------------------|---------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|---------------------------------------------------------|
| CRUD  | `/api/v1/admin/authors` | Управление авторами (создать, прочитать, обновить, удалить)                                             | Поля пользователя и автора                                              | Данные и подтверждения операций                         |
| CRUD  | `/api/v1/admin/books`   | Управление книгами                                                                                      | Поля книги (название уникально)                                         | Данные и подтверждения операций                         |
| CRUD  | `/api/v1/admin/genres`  | Управление жанрами                                                                                      | Поля жанра                                                              | Данные и подтверждения операций                         |
| GET   | `/api/v1/admin/books`   | Список всех книг (пагинация, поиск по названию, фильтрация по авторам и жанрам, сортировка по названию) | ?skip=, ?take=, ?author_id=, ?title=, ?genre_ids[]=, ?is_sort_by_title= | Пагинированный, отфильтрованный, отсортированный список |
| GET   | `/api/v1/admin/authors` | Список авторов с количеством книг (пагинация)                                                           | ?skip=, ?take=                                                          | Пагинированный список авторов с количеством книг        |
| GET   | `/api/v1/admin/genres`  | Список жанров с количеством книг (пагинация)                                                            | ?skip=, ?take=                                                          | Пагинированный список жанров с количеством книг         |
